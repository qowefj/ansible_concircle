---
- name: Configure Windows Update schedule and initiate updates
  hosts: windows
  gather_facts: no
  tasks:
    - name: Configure Automatic Updates to download and install at 1 PM on Saturdays
      win_shell: |
        $AutoUpdateSettings = (New-Object -ComObject "Microsoft.Update.AutoUpdate").Settings
        $AutoUpdateSettings.NotificationLevel = 3  # Notify before download
        $AutoUpdateSettings.ScheduledInstallDay = 6  # Saturday
        $AutoUpdateSettings.ScheduledInstallTime = 13  # 1 PM
        $AutoUpdateSettings.Save()
      args:
        executable: powershell

    - name: Trigger Windows Update download and installation
      win_shell: |
        Install-WindowsUpdate -AcceptAll -AutoReboot
      args:
        executable: powershell
